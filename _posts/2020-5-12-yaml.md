---
layout: post
title: Working with YAML in Python
tags: [ python, automation ]
image: /img/python-logo.jpg
---

https://github.com/saidvandeklundert/saidvandeklundert.github.io/blob/yaml/_posts/2020-5-12-yaml.md

This post contains some notes and examples for working with YAML in Python3 using PyYAML version 5.2.

### YAML intro

YAML stands for 'YAML Ain't Markup Language'. 

The following from https://yaml.org/spec/1.2/spec.html 1.3, written in relation to JSON, captures YAML quite nicely:
```
YAMLâ€™s foremost design goals are human readability and support for serializing arbitrary native data structures. Thus, YAML allows for extremely readable files, but is more complex to generate and parse.
```

Another interesting part is the following:

```
YAML can therefore be viewed as a natural superset of JSON, offering improved human readability and a more complete information model. This is also the case in practice; every JSON file is also a valid YAML file. This makes it easy to migrate from JSON to YAML if/when the additional features are required.
```

Many frameworks and tools have users specify configurations using YAML. 

### Python to YAML serialization

As an example, we will translate the following dictionary to YAML using `yaml.dump`:

```python
d = {
  'string' : 'string',
  'list': ['item-1', 'item-2',],  
  'nested-dictionary' : { 
    'key-1' : 'value-1',
    'key-2' : 'value-2',
  },
  'True' : True,
  'False' : False,
  'None' : None,
}
```

Using <b>print(yaml.dump(d,sort_keys=False))</b>, we can see this translates into the following YAML:

```yaml
string: string
list:
- item-1
- item-2
nested-dictionary:
  key-1: value-1
  key-2: value-2
'True': true
'False': false
None: null
```

To quickly check how a Python data structure converts to YAML, drop to the Python interpreter and perform the following:

<pre style="font-size:12px">
>>> <b>print(yaml.dump(('switch-1', 'switch-2'),sort_keys=False))</b>
!!python/tuple
- switch-1
- switch-2
</pre>


### Emit a Python object as a string of YAML

The <b>dump</b> method is used to serialize a Python object into a YAML stream. In the next example, we emit the Python dictionary as a string:

```python
import yaml

d = {
  'True' : True,
  'False' : False,
  'None' : None,
}

print(yaml.dump(d))
```

The script will output the following:

<pre style="font-size:12px">
'False': false
None: null
'True': true
</pre>

Dump will sort the keys for you. If this is not what you want, use the following to change it:


```python
import yaml

d = {
  'a' : 'a',
  'e' : 'e',      
  'b' : 'b',
  'd' : 'd',
  'c' : 'c',  
}

print(yaml.dump(d, sort_keys=False))
```

This will output the following:

<pre style="font-size:12px">
a: a
e: e
b: b
d: d
c: c
</pre>

### Dump Python object as YAML in a file:

Here, we use the <b>dump</b> method to write a Python object to a file we just opened:

```python
import yaml

d = { 'key' : 'value' }
with open("example.yaml", "w") as fh:  
  (yaml.dump(d, fh))
```

This example results in the following YAML file:

<pre style="font-size:12px">
[root@said ~]$ more example.yaml 
key: value
</pre>

To dump YAML to a file while writing additional (comments) to the file:

```python
import yaml

d = { 'key' : 'value' }
with open("example.yaml", "w") as fh:
  fh.write("{# File generated by script xxx #}\n")
  fh.write(yaml.dump(d))
```

This example produces the following:

<pre style="font-size:12px">
[root@said ~]$ more example.yaml 
{# File generated by script xxx #}
key: value
</pre>

### Create a Python object from a YAML string

```python
import yaml

yaml_string = """
France:
  capital: Paris
Italy:
  capital: Rome
list_of_items:
  - item 1
  - item 2
  - item 3  
"""

python_object = yaml.load(yaml_string, Loader=yaml.FullLoader)
print(python_object)
```

This script outputs the following:
<pre style="font-size:12px">
{'France': {'capital': 'Paris'}, 'Italy': {'capital': 'Rome'}, 'list_of_items': ['item 1', 'item 2', 'item 3']}
</pre>


### Create a Python object from a YAML file

```python
import yaml

yaml_file = "example.yaml"

with open(yaml_file, "r") as fh:
  python_object = yaml.load(fh, Loader=yaml.FullLoader)

print(python_object)
```
We'll run the example script with the following `example.yaml` file:
<pre style="font-size:12px">
sh-4.4# more example.yaml 
key: value
sh-4.4# 
</pre>

The output of the script:

<pre style="font-size:12px">
{'key': 'value'}
</pre>


### Dictify a web page

```python
import yaml
from urllib.request import urlopen
import ssl
import pprint

html_content = urlopen('http://netutilitydal0502/~netdevice/network_pillar/network_pillar.yaml').read()  

html_yaml = yaml.safe_load(html_content)

pprint.pprint(html_yaml)
```

### Using YAML in jinja


```python
import yaml
from jinja2 import Template

yaml_string  = '''
---
- hostname: ny01
  mgmt-ip: 10.0.0.1
- hostname: ny02
  mgmt-ip: 10.0.0.2
- hostname: ny03
  mgmt-ip: 10.0.0.3
- hostname: ny04
  mgmt-ip: 10.0.0.4
    '''
# Load YAML from string:
routers = yaml.full_load(yaml_string)

# Define template:
template = Template('''

{% for router in routers %}
hostname {{ router['hostname'] }}
set interfaces lo0 unit 0 family inet address {{ router['mgmt-ip'] }} primary
{% endfor %}

''')

print(template.render(routers = routers))
```

Running the example script produces the following:

<pre style="font-size:12px">

set system host-name ny01
set interfaces lo0 unit 0 family inet address 10.0.0.1 primary

set system host-name ny02
set interfaces lo0 unit 0 family inet address 10.0.0.2 primary

set system host-name ny03
set interfaces lo0 unit 0 family inet address 10.0.0.3 primary

set system host-name ny04
set interfaces lo0 unit 0 family inet address 10.0.0.4 primary

</pre>



====






### Links related to YAML:


<a href="https://yaml.org/" target="_blank">yaml.org</a>

<a href="https://pyyaml.org/wiki/PyYAMLDocumentation" target="_blank">PyYAML documentation</a>

<a href="https://github.com/yaml/pyyaml" target="_blank">PyYAML github</a>



https://noyaml.com/

Interesting from https://yaml.org/spec/1.2/spec.html 1.3. Relation to JSON:





Some of YAMLs basic characteristics are the following:
- YAML is case-sensitive
- YAML does not ignore whitespaces
- YAML uses indents for structure
- YAML uses spaces, not tabs
- it is customary to start YAML documents with three dashes '---' (not required)
- Comments start with a '#'
- Strings do not need quotes unless they include special characters
- YAML structures:
  * mappings
  * sequences


YAML mappings.
Mappings are key-value pairs, similar to JSON objects. Example of a mapping:
---
name : Bob
height : 6 foot

YAML sequences.

Sequences are lists or arrays of data, and are similar to JSON arrays. Sequence items start with a dash, example:

---
-apple
-orange
-banana

Sequences do not have to have a name associated with them.



```python
sa
```


